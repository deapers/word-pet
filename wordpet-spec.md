# 小词怪 WordPet - 完整规格文档

## 1. 项目概述
- **平台**：单页面 HTML5（浏览器/PWA）
- **目标用户**：6-12岁儿童
- **核心理念**：通过简单日常句子练习 + 游戏化互动 + 宠物成长，激发自主学习兴趣
- **玩法形式**：
  - 句子拼接游戏（类似 Sequence Chinese Word Game）
  - 宠物成长/奖励系统
  - 错题复习
- **核心玩法**：句子拼接 (sentence jigsaw) 游戏，儿童可以通过点击方式将单词拖拽并排列成正确的句子
- **游戏化设计**：虚拟宠物成长系统，与学习进度关联
- **学习强化**：错误袋系统，用于复习困难句子
- **儿童友好**：以非惩罚性反馈方式设计，最小化挫败感

## 2. 核心设计目标

| 目标 | 设计方向 |
|------|-----------|
| 轻量化 | 单 HTML 页面 + JS/CSS 控制所有逻辑和界面 |
| MVP 优先 | 基础句子拼接 + 宠物成长 + 错题复习 |
| 低挫败感 | 答错不扣分，加入错题包和少量奖励 |
| 主动学习 | 错题复习有额外奖励 |
| 游戏化 | 宠物动画、金币/食物、连击奖励 |
| 防沉溺 | 每日体力上限，离线成长机制 |

## 3. 功能模块

### 3.1 首页
- 显示宠物状态（等级/经验/体力）
- 今日学习进度（已练习句子数/复习次数/金币）
- 按钮：
  - [开始练习] → 句子拼接游戏
  - [错题复习] → 错题页面
  - [喂食宠物] → 宠物成长动画
  - [设置] → 音效/每日体力限制

### 3.2 句子拼接游戏
- 显示一个句子被打乱成单词或短语块
- 玩家拖动或点击顺序拼接句子
- 出题策略：
  - 日常生活句子为主（问候、天气、家庭、学校等）
  - 错题优先出现
- 答题逻辑：
  - 拼对 → 金币 + 经验 + 连击奖励动画
  - 拼错 → 加入错题包 + 少量奖励
- 句子长度短，降低挫败感
- 来自日常生活主题的随机单词序列（食物、动物、天气、家庭、学校等）
- 点击排序接口的句子构造
- 正确答案奖励系统，包含连击奖励
- 错误答案进入错误袋
- 完成一个句子（正确或错误）后，如果达到50个句子上限，则返回主页
- 如果用户在游戏过程中主动点击"返回主页"按钮，则返回主页

### 3.3 错题复习
- 展示错题句子列表
- 玩家可主动复习（复用拼句子游戏）
- 复习成功 → mastery 提升 + 双倍奖励
- mastery ≥ 0.8 → 从错题包移除
- 从错误袋中随机抽取句子进行复习
- 提供错误复习的额外奖励（60%更多金币，50%更多经验值）

### 3.4 宠物成长
- 宠物等级随经验增加
- 成长动画或装饰解锁
- 体力消耗限制每日练习次数
- 离线恢复：每小时 +1 体力，宠物经验也可增加
- 宠物从正确答案和宠物护理活动中获得经验
- 升级经验阈值随宠物等级增加而增加（100 + 等级 * 50）
- 宠物表情符号随等级增加而变化（🐶 → 🐩 → 🐕‍🦺）
- 离线经验基于自上次游戏以来经过的时间获得

### 3.5 设置页面
- 音效/TTS 开关
- 每日体力上限配置
- 家长模式（查看错题、学习进度）

## 4. 技术架构与技术栈

### 4.1 架构
- **前端**：HTML5, CSS3, JavaScript (ES6+)
- **数据存储**：LocalStorage 持久化
- **游戏机制**：基于点击的拖拽功能进行句子组装
- **动画效果**：CSS动画用于宠物成长和奖励
- **无障碍性**：文字转语音 (TTS) 支持学习

### 4.2 项目结构
```
index.html - 单页面框架
style.css - 样式和动画
game.js - 核心游戏逻辑
data.js - 句子库和错误数据
pet.js - 宠物成长逻辑
utils.js - 奖励计算、体力管理、TTS 和工具函数
```

## 5. 数据模型（轻量化）

应用使用JSON结构存储在LocalStorage中：

```json
{
  "player": {
    "level": 1,
    "coins": 0,
    "stamina": 0,  // 当前体力值
    "maxStamina": 5,  // 最大体力值（满5点）
    "staminaRechargeTime": 60000,  // 1分钟（60000ms）- 每分钟恢复1点
    "lastStaminaUpdate": "timestamp",  // 最后体力更新时间
    "currentCombo": 0,
    "maxCombo": 0,
    "totalSentencesCompleted": 0,
    "totalMistakesMade": 0
  },
  "pet": {
    "level": 1,
    "exp": 0,
    "expToNextLevel": 100,
    "decorations": [],
    "lastGrowthUpdate": "timestamp",
    "offlineExpGain": 10
  },
  "sentences": [
    {
      "text": "I like apples",
      "mastery": 0.5,
      "lastReviewed": "timestamp",
      "incorrectCount": 1,
      "correctCount": 2,
      "difficulty": "easy",
      "category": "food"
    }
  ],
  "mistakeBag": {
    "sentences": ["sentence text"],
    "reviewPriority": 0.3
  },
  "failedSentences": {
    "sentences": ["sentence text"],
    "failureCounts": {"sentence text": 2},
    "lastFailedDate": {"sentence text": "timestamp"}
  }
}
```

## 6. 实现细节

### 6.1 游戏流程
1. 玩家从带宠物显示和状态的主页开始
2. 玩家选择"开始练习"以开始句子拼图
3. 游戏检查玩家是否有力气并获取下一个句子（错误袋项目有30%优先级）
4. 句子单词被打乱并呈现以便排列
5. 玩家通过点击将单词排列到句子目标中
6. 提交后检查正确性并给予适当的奖励/反馈
7. 游戏更新玩家/宠物状态并根据模式返回主页或继续

### 6.2 句子掌握度系统
- 正确答案：+0.15掌握度，最小0.0，最大1.0
- 错误答案：-0.05掌握度，最小0.0，最大1.0
- 掌握度 < 0.8 的句子进入错误袋
- 掌握度 ≥ 0.8 的句子从错误袋移除
- 掌握度决定句子是否被视为"已学会"
- 出题顺序：句子掌握度越低，越先出题
- 对已掌握的句子，也需要考虑记忆曲线，对掌握度进行缓减

### 6.3 体力系统
- 默认5点体力，最大5点
- 体力以每分钟1点（60,000ms）的速度恢复
- 每次Start Practice消耗1点体力
- "复习错误"模式不消耗体力
- 防止过度使用并鼓励间隔学习

### 6.4 激励体系
| 场景 | 奖励方式 |
|------|-----------|
| 连续答对 | Combo 动画 + 双倍金币 |
| 错题复习 | 修正成功动画 + 双倍奖励 |
| 宠物成长 | 等级提升动画 + 装饰解锁 |
| 每日登录 | 宠物日记/小奖励 |
| 答错 | 加入错题包 + 少量金币/经验（低挫败感） |

## 7. 出题策略

| 来源 | 占比 | 逻辑 |
|------|------|------|
| 当前日常句子 | 70% | 每日新句子 + 复习句子 |
| 错题复习 | 30% | 优先出现在错题包中 |

拼接句子游戏随机打乱单词顺序

主题句子可按日常分类：问候/天气/家庭/学校/食物/交通等

## 8. 功能需求

### 8.1 体力系统需求
- 每次"Start Practice"消耗1点体力
- "Review Mistakes"功能启动时不需要体力，也不消耗体力
- "Review Mistakes"按钮即使体力为0也保持启用
- 其他游戏模式（Start Practice）应继续要求和消耗体力

### 8.2 游戏模式需求
- **连续模式**："Start Practice"按钮自动进入连续模式，可连续完成最多50道题
- **句子计数**：在连续模式下，应显示"Sentence X/50"格式的句子计数
- **跳过按钮**：在连续模式下，应显示"Skip"按钮，用于跳过当前句子。单次游戏，累计跳过5个句子后，游戏应自动返回主页
- **错误袋**：错误袋项目有30%优先级
- 游戏会话可通过以下三种方式结束：
  1. 用户点击"返回主页"按钮
  2. 用户累积5个跳过句子
  3. 用户达到句子限制（用于连续模式）
- 正确答案应继续下一题或保持当前游戏状态
- 错误答案应保持当前游戏状态，允许玩家重试。直至回答正确，才能继续下一题

### 8.3 页面导航需求
- 提交答案（无论正确或错误）后，游戏页面不应自动返回主页
- 只在以下三种情况返回主页：
  1. 累计跳过5次句子
  2. 点击"Back to Home"按钮
  3. 达到单次游戏的句子上限（50个句子）
- 正确答案应继续下一题或保持当前游戏状态
- 错误答案应保持当前游戏状态，允许玩家重试

### 8.4 计数显示需求
- 在连续模式下，应显示"Sentence X/50"格式的句子计数
- 跳过句子后，句子计数保持不变
- 句子计数只在返回主页或开始新的游戏会话时重置
- 在跳过句子后获取新句子时应显示适当的进度信息

### 8.5 用户体验元素
- 连续正确答案连击追踪
- 正确和错误答案的鼓励反馈信息
- 单词和反馈信息的文字转语音功能
- 升级和奖励的视觉动画

## 9. 页面结构（HTML5 单页）

- 首页：宠物状态、每日进度、开始练习按钮
- 游戏区：拖动/点击拼句子
- 错题区：复习错题列表
- 宠物区：喂食、成长动画
- 设置区：音效/体力/家长模式

## 10. 技术实现建议

HTML/CSS/JS 实现前端逻辑

LocalStorage 保存玩家进度、错题和宠物状态

Canvas 或 div 拖拽 实现句子拼接游戏

CSS 动画或 Lottie JSON 实现宠物成长和奖励动画

轻量化：单页面加载，无服务端依赖

离线支持：启动时计算时间差更新宠物经验/体力

模块化结构：
- index.html：单页框架
- style.css：样式
- game.js：核心游戏逻辑
- data.js：句子库/错题数据
- pet.js：宠物成长逻辑
- utils.js：奖励计算、体力管理、TTS

## 11. 核心循环图
首页 → 句子拼接游戏 → 奖励/更新数据 → 宠物成长动画 → 回首页
        │
        └─> 错题复习（主动复习奖励）

## 12. 开发顺序建议（MVP）

1. 搭建单页面框架（HTML + CSS）
2. 实现句子拼接游戏核心逻辑（JS）
3. 实现 LocalStorage 数据存储
4. 加入奖励/连击/错题包机制
5. 实现宠物成长动画和体力限制
6. 完成错题复习功能
7. 增加设置/家长模式

## 13. 设计哲学

- **轻量级**：单HTML文件嵌入JS/CSS
- **无挫败感**：错误回答提供最小惩罚，有机会获得小奖励
- **自主学习**：错误复习提供额外奖励
- **游戏化**：宠物动画、金币/食物和连击奖励
- **防上瘾**：每日体力限制和离线增长机制
- **无障碍性**：文字转语音、大触摸目标和键盘导航支持

## 14. 开发原则

项目遵循以下关键开发原则：

- **规格驱动开发 (Spec-driven Development)**：所有更改都从在`specs/`目录中创建规格文档开始
- **AI友好设计**：代码和文档使用清晰易懂的中文和结构
- **模块化开发**：各功能模块相对独立，便于维护和扩展
- **用户体验优先**：始终考虑儿童用户的特点和需求

## 15. 模式描述

### 15.1 标准练习模式
- 点击"Start Practice"进入统一的连续模式
- 可连续完成最多50道题
- 每次开始练习消耗1点体力
- 同时具备句子计数显示功能

### 15.2 错误复习模式
- 点击"Review Mistakes"进入
- 从错误袋中随机抽取句子进行复习
- 不消耗体力
- 提供错误复习的额外奖励

### 15.3 宠物护理模式
- 点击"Pet Care"进入
- 可以喂养宠物或与宠物玩耍
- 提供少量经验值奖励