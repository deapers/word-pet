# 小词怪 WordPet - 完整需求文档

## 1. 项目概述

**小词怪 WordPet** (WordPet) 是一款专为6-12岁儿童设计的教育游戏，通过游戏化方式帮助孩子学习句子构造。项目是一个单页面HTML5应用（PWA），主要特色包括：

- **核心玩法**：句子拼接 (sentence jigsaw) 游戏，儿童可以通过点击方式将单词拖拽并排列成正确的句子
- **游戏化设计**：虚拟宠物成长系统，与学习进度关联
- **学习强化**：错误袋系统，用于复习困难句子
- **儿童友好**：以非惩罚性反馈方式设计，最小化挫败感

## 2. 技术架构与技术栈

### 2.1 架构
- **前端**：HTML5, CSS3, JavaScript (ES6+)
- **数据存储**：LocalStorage 持久化
- **游戏机制**：基于点击的拖拽功能进行句子组装
- **动画效果**：CSS动画用于宠物成长和奖励
- **无障碍性**：文字转语音 (TTS) 支持学习

### 2.2 项目结构
```
index.html - 单页面框架
style.css - 样式和动画
game.js - 核心游戏逻辑
data.js - 句子库和错误数据
pet.js - 宠物成长逻辑
utils.js - 奖励计算、体力管理、TTS 和工具函数
```

## 3. 核心功能

### 3.1 句子拼接游戏
- 来自日常生活主题的随机单词序列（食物、动物、天气、家庭、学校等）
- 点击排序接口的句子构造
- 正确答案奖励系统，包含连击奖励
- 错误答案进入错误袋

### 3.2 宠物成长系统
- 通过正确答案获得经验值
- 等级进度，带视觉奖励（表情符号变化）
- 体力系统防止过度使用（随时间恢复）
- 离线经验/能量再生

### 3.3 学习强化
- 错误袋优先复习（30%出现概率）
- 每个句子的掌握度追踪
- 错误纠正奖励（60%更多金币，50%更多经验值）

### 3.4 用户体验元素
- 连续正确答案连击追踪
- 正确和错误答案的鼓励反馈信息
- 单词和反馈信息的文字转语音功能
- 升级和奖励的视觉动画

## 4. 数据模型

应用使用JSON结构存储在LocalStorage中：

```json
{
  "player": {
    "level": 1,
    "coins": 0,
    "stamina": 0,  // 当前体力值
    "maxStamina": 5,  // 最大体力值（满5点）
    "staminaRechargeTime": 60000,  // 1分钟（60000ms）- 每分钟恢复1点
    "lastStaminaUpdate": "timestamp",  // 最后体力更新时间
    "currentCombo": 0,
    "maxCombo": 0,
    "totalSentencesCompleted": 0,
    "totalMistakesMade": 0
  },
  "pet": {
    "level": 1,
    "exp": 0,
    "expToNextLevel": 100,
    "decorations": [],
    "lastGrowthUpdate": "timestamp",
    "offlineExpGain": 10
  },
  "sentences": [
    {
      "text": "I like apples",
      "mastery": 0.5,
      "lastReviewed": "timestamp",
      "incorrectCount": 1,
      "correctCount": 2,
      "difficulty": "easy",
      "category": "food"
    }
  ],
  "mistakeBag": {
    "sentences": ["sentence text"],
    "reviewPriority": 0.3
  },
  "failedSentences": {
    "sentences": ["sentence text"],
    "failureCounts": {"sentence text": 2},
    "lastFailedDate": {"sentence text": "timestamp"}
  }
}
```

## 5. 实现细节

### 5.1 游戏流程
1. 玩家从带宠物显示和状态的主页开始
2. 玩家选择"开始练习"以开始句子拼图
3. 游戏检查玩家是否有力气并获取下一个句子（错误袋项目有30%优先级）
4. 句子单词被打乱并呈现以便排列
5. 玩家通过点击将单词排列到句子目标中
6. 提交后检查正确性并给予适当的奖励/反馈
7. 游戏更新玩家/宠物状态并根据模式返回主页或继续

### 5.2 句子掌握度系统
- 正确答案：+0.15掌握度，最小0.0，最大1.0
- 错误答案：-0.05掌握度，最小0.0，最大1.0
- 掌握度 < 0.8 的句子进入错误袋
- 掌握度 ≥ 0.8 的句子从错误袋移除
- 掌握度决定句子是否被视为"已学会"
- 出题顺序：句子掌握度越低，越先出题
- 对已掌握的句子，也需要考虑记忆曲线，对掌握度进行缓减

### 5.3 体力系统
- 默认5点体力，最大5点
- 体力以每分钟1点（60,000ms）的速度恢复
- 每次Start Practice消耗1点体力
- "复习错误"模式不消耗体力
- 防止过度使用并鼓励间隔学习

### 5.4 宠物成长系统
- 宠物从正确答案和宠物护理活动中获得经验
- 升级经验阈值随宠物等级增加而增加（100 + 等级 * 50）
- 宠物表情符号随等级增加而变化（🐶 → 🐩 → 🐕‍🦺）
- 离线经验基于自上次游戏以来经过的时间获得

## 6. 功能需求

### 6.1 体力系统需求
- 每次"Start Practice"消耗1点体力
- "Review Mistakes"功能启动时不需要体力，也不消耗体力
- "Review Mistakes"按钮即使体力为0也保持启用
- 其他游戏模式（Start Practice）应继续要求和消耗体力

### 6.2 游戏模式需求
- **连续模式**："Start Practice"按钮自动进入连续模式，可连续完成最多50道题
- **句子计数**：在连续模式下，应显示"Sentence X/50"格式的句子计数
- **跳过按钮**：在连续模式下，应显示"Skip"按钮，用于跳过当前句子。单次游戏，累计跳过5个句子后，游戏应自动返回主页
- **错误袋**：错误袋项目有30%优先级
- 游戏会话可通过以下三种方式结束：
  1. 用户点击"返回主页"按钮
  2. 用户累积5个跳过句子
  3. 用户达到句子限制（用于连续模式）
- 正确答案应继续下一题或保持当前游戏状态
- 错误答案应保持当前游戏状态，允许玩家重试。直至回答正确，才能继续下一题


### 6.5 计数显示需求
- 在连续模式下，应显示"Sentence X/50"格式的句子计数
- 跳过句子后，句子计数保持不变
- 句子计数只在返回主页或开始新的游戏会话时重置
- 在跳过句子后获取新句子时应显示适当的进度信息

## 7. 设计哲学

- **轻量级**：单HTML文件嵌入JS/CSS
- **无挫败感**：错误回答提供最小惩罚，有机会获得小奖励
- **自主学习**：错误复习提供额外奖励
- **游戏化**：宠物动画、金币/食物和连击奖励
- **防上瘾**：每日体力限制和离线增长机制
- **无障碍性**：文字转语音、大触摸目标和键盘导航支持

## 8. 开发原则

项目遵循以下关键开发原则：

- **规格驱动开发 (Spec-driven Development)**：所有更改都从在`specs/`目录中创建规格文档开始
- **AI友好设计**：代码和文档使用清晰易懂的中文和结构
- **模块化开发**：各功能模块相对独立，便于维护和扩展
- **用户体验优先**：始终考虑儿童用户的特点和需求

## 9. 模式描述

### 9.1 标准练习模式
- 点击"Start Practice"进入统一的连续模式
- 可连续完成最多50道题
- 每次开始练习消耗1点体力
- 同时具备句子计数显示功能

### 9.2 错误复习模式
- 点击"Review Mistakes"进入
- 从错误袋中随机抽取句子进行复习
- 不消耗体力
- 提供错误复习的额外奖励

### 9.3 宠物护理模式
- 点击"Pet Care"进入
- 可以喂养宠物或与宠物玩耍
- 提供少量经验值奖励

## 10. 词库管理规格

### 10.1 词库存储
- 句子数据直接嵌入在 `data.js` 文件中
- 只包含句子的基础属性（文本内容、分类、难度）
- 状态相关数据（掌握度、复习时间、对错次数）在运行时动态生成和维护
- 与游戏逻辑代码分离，便于维护和更新

### 10.2 词库同步加载
- 游戏启动时同步从嵌入数据加载词库
- 保持与本地存储中用户数据（掌握度、错误袋等）的兼容性
- 为避免CORS问题，在本地文件环境下使用嵌入式数据

### 10.3 词库更新机制
- 支持通过修改 `data.js` 中的嵌入数据来添加、删除或修改句子
- 保留用户对句子的掌握度数据，即使词库更新
- 新增的句子将初始化为默认掌握度（0.0）